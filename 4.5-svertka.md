# Подглава 4.5 Свертка

Время от времени вы сталкиваетесь с какой-то математической конструкцией, которая превращает сложную задачу просто в множество действий со сложением, вычитанием, умножением и делением. Таким образом работают векторы в геометрии, и при обработке изображения мы имеем ядро свёртки. Выясняется, что большинство распространенных методов обработки изображений — обнаружение краев, обнаружение углов, повышение резкости, улучшение и так далее, может быть реализовано с помощью простой конструкции массива.

Довольно легко понять, что на изображении соседи пикселя так же важны, как и сам пиксель. Если бы вы попытались найти все крайние пиксели блока, вы бы искали пиксель, который имеет один тип цвета \(оттенок\) с одной стороны, и другой тип — с другой. Нам нужна функция, которая находит края путем сравнения пикселей с одной и второй стороны пикселя.

Ядро свёртки — это матричная функция, которая применяет вес к соседям пикселя — или пикселям вокруг одного пикселя, который мы анализируем. Функция обычно записывается матрицей 3 x 3:

![](.gitbook/assets/image%20%285%29.png)

Это метод выделения контура _**оператор Собеля**_ в направлении Y. Он обнаруживает края, идущие вверх и вниз. Каждый блок представляет собой пиксель. Обрабатываемый пиксель находится в центре. Соседями пикселей с каждой стороны являются остальные блоки — верхний, нижний, левый и правый. Чтобы вычислить свёртку, вы применяете вес к значению каждого пикселя, умножая значение \(интенсивность\) этого пикселя, и затем складывая все результаты. Если это изображение цветное — RGB — тогда мы вычисляем свёртку для каждого цвета отдельно и затем объединяем результат. Вот пример свёртки, применяемой к пикселю:

![](.gitbook/assets/image%20%288%29.png)

Добавьте окончательный результат к начальному изображению. Обратите внимание, что в результате мы получим только края — если цвета одинаковы по обе стороны от центрального пикселя, они взаимно компенсируют друг друга, и мы получаем ноль, или черный. Если они разные, мы получим 255, или белый в качестве результата.

Если нам нужен более сложный результат, мы также можем использовать свёртку 5 x 5, которая учитывает два ближайших пикселя с каждой стороны, а не только один.

Хорошая новость заключается в том, что вам не нужно выбирать свёртку для применения к входным изображениям — интерфейс Keras настроит все свёртки, а вам нужно всего лишь задать размер как 3 x 3 или 5 x 5. Нейронная сеть определит, какие свёртки предоставляют больше данных и предоставляют те результаты обучения, которые мы хотим.

Подождите, я слышу, что вы говорите. Что если пиксель находится на краю изображения, и у нас нет соседних пикселей с одной стороны? В этом случае мы должны добавить отступы к изображению — которые являются границами дополнительных пикселей, что позволяет нам также учитывать граничащие пиксели.

